<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vanilla Counter with Test Component</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="my-8" id="app">
        <div class="max-w-md mx-auto p-6 bg-gray-100 rounded-lg shadow-md mb-6">
            <div class="mb-6">
                <div id="countDisplay" class="text-xl font-semibold bg-gray-200 p-3 rounded mb-2"></div>
                <div id="doubledCount" class="mb-1"></div>
                <div id="combinedCount" class="mb-4"></div>
            </div>

            <div class="flex flex-wrap gap-2 mb-6">
                <button id="incrementBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">+</button>
                <button id="decrementBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">-</button>
                <button id="colorBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">Change color</button>
                <button id="widthBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Increase width</button>
                <button id="globalBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">Change global signal</button>
            </div>

            <div class="mb-4">
                <h1 id="globalText" class="text-2xl font-bold mb-2"></h1>
                <p id="prop2Text" class="p-2 border border-gray-300 rounded"></p>
            </div>

            <div class="mb-4">
                <button id="fetchBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded mb-4">Fetch</button>
                <div class="flex flex-col gap-2">
                    <input type="text" id="textInput" class="border border-gray-300 p-2 rounded">
                    <p id="inputDisplay" class="italic"></p>
                </div>
            </div>

            <div id="testComponent" class="block mt-4 p-4 bg-gray-50 border border-gray-200 rounded"></div>

            <div class="mt-6 p-4 bg-gray-50 rounded border border-gray-200">
                <p id="apiTitle" class="font-medium mb-2">Click + or - to fetch data</p>
            </div>
        </div>
    </div>

    <template id="test-component">
        <div class="space-y-3">
            <p class="text-gray-700 font-medium"></p>
            <input type="text" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <p class="italic text-gray-600"></p>
            <div class="flex gap-2">
                <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition">
                    Change Count
                </button>
                <button class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded transition">
                    Change Size
                </button>
            </div>
        </div>
    </template>

    <script>
        // State
        const state = {
            count: 1,
            color: 'text-black',
            width: '150px',
            input: 'Hello World',
            globalSignal: 'Hello World',
            prop2: 'Hello World',
            apiData: null,
            apiLoading: false,
            apiError: null
        };

        // Create test component instance
        function createTestComponent(container, props) {
            const template = document.getElementById('test-component');
            const clone = template.content.cloneNode(true);
            
            const widthDisplay = clone.querySelector('p.text-gray-700');
            const input = clone.querySelector('input');
            const inputDisplay = clone.querySelector('p.italic');
            const changeCountBtn = clone.querySelector('.bg-blue-500');
            const changeSizeBtn = clone.querySelector('.bg-purple-500');

            // Update function
            function updateComponent() {
                widthDisplay.textContent = state.width;
                input.value = state.input;
                inputDisplay.textContent = state.input;
            }

            // Event listeners
            changeCountBtn.addEventListener('click', () => {
                state.count--;
                updateCounts();
                fetchData();
            });

            changeSizeBtn.addEventListener('click', () => {
                state.width = '20px';
                updateCounts();
                updateGlobalText();
                updateComponent();
            });

            input.addEventListener('input', (e) => {
                state.input = e.target.value;
                updateTextInput();
                updateComponent();
            });

            container.appendChild(clone);
            updateComponent();
            return updateComponent;
        }

        // Cache DOM elements
        const elements = {
            countDisplay: document.getElementById('countDisplay'),
            doubledCount: document.getElementById('doubledCount'),
            combinedCount: document.getElementById('combinedCount'),
            textInput: document.getElementById('textInput'),
            inputDisplay: document.getElementById('inputDisplay'),
            apiTitle: document.getElementById('apiTitle'),
            globalText: document.getElementById('globalText'),
            prop2Text: document.getElementById('prop2Text'),
            testComponent: document.getElementById('testComponent')
        };

        // Create test component instance
        const updateTestComponent = createTestComponent(elements.testComponent);

        // Update functions
        function updateCounts() {
            const doubled = state.count * 2;
            elements.countDisplay.className = `${state.color} text-xl font-semibold bg-gray-200 p-3 rounded mb-2 w-[${state.width}]`;
            elements.countDisplay.textContent = `Current count: ${state.count}`;
            elements.doubledCount.className = state.color;
            elements.doubledCount.textContent = `Doubled count: ${doubled}`;
            elements.combinedCount.className = state.color;
            elements.combinedCount.textContent = `Current count: ${state.count}; doubled count: ${doubled}`;
            updateTestComponent();
        }

        function updateTextInput() {
            elements.textInput.value = state.input;
            elements.inputDisplay.textContent = state.input;
            updateTestComponent();
        }

        function updateGlobalText() {
            elements.globalText.textContent = state.globalSignal;
            elements.prop2Text.style.width = state.width;
            elements.prop2Text.textContent = state.prop2;
            updateTestComponent();
        }

        async function fetchData() {
            try {
                state.apiLoading = true;
                elements.apiTitle.textContent = 'loading...';
                
                const response = await fetch(`https://jsonplaceholder.typicode.com/todos/${state.count}`);
                const data = await response.json();
                
                state.apiData = data;
                state.apiLoading = false;
                state.apiError = null;
                
                elements.apiTitle.textContent = data.title;
            } catch (error) {
                state.apiError = error;
                state.apiLoading = false;
                elements.apiTitle.textContent = 'error';
            }
        }

        // Event Listeners for main component
        document.getElementById('incrementBtn').addEventListener('click', () => {
            state.count++;
            updateCounts();
            fetchData();
        });

        document.getElementById('decrementBtn').addEventListener('click', () => {
            state.count--;
            updateCounts();
            fetchData();
        });

        document.getElementById('colorBtn').addEventListener('click', () => {
            state.color = state.color === 'text-black' ? 'text-red-500' : 'text-black';
            updateCounts();
        });

        document.getElementById('widthBtn').addEventListener('click', () => {
            state.width = (parseInt(state.width) + 20) + 'px';
            updateCounts();
            updateGlobalText();
        });

        document.getElementById('globalBtn').addEventListener('click', () => {
            state.globalSignal = state.globalSignal === 'Hello World' ? 'Goodbye World' : 'Hello World';
            updateGlobalText();
        });

        document.getElementById('fetchBtn').addEventListener('click', async () => {
            const response = await fetch('https://jsonplaceholder.typicode.com/todos/1');
            const data = await response.json();
            state.input = data.title;
            updateTextInput();
        });

        elements.textInput.addEventListener('input', (e) => {
            state.input = e.target.value;
            updateTextInput();
        });

        // Initial render
        updateCounts();
        updateTextInput();
        updateGlobalText();
        fetchData();
    </script>
</body>
</html>